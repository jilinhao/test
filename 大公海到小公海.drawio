<mxfile host="app.diagrams.net" modified="2021-01-11T01:36:01.266Z" agent="5.0 (Macintosh; Intel Mac OS X 11_1_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36" etag="uMqTi5WHi1EEllZEmKum" version="14.1.8" type="github">
  <diagram id="xhLX_bbHOacLEbQQJA1L" name="Page-1">
    <mxGraphModel dx="946" dy="589" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="1920" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-1" target="Liaz7uwgIyD5OLgwqCPN-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-1" value="大公海分配到小公海" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="510" y="10" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-2" target="Liaz7uwgIyD5OLgwqCPN-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-2" value="定义两个结果是切片，值是结构体的变量&lt;br&gt;saveLeadsList&lt;br&gt;leadsFlowList" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="497.5" y="60" width="145" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-4" value="struct{&lt;br&gt;BusinessId&lt;br&gt;StaffId&lt;br&gt;State&lt;br&gt;LeadsId&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="330" y="45" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-5" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-4" target="Liaz7uwgIyD5OLgwqCPN-2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="410" y="110" as="sourcePoint" />
            <mxPoint x="460" y="60" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.833;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-6" target="Liaz7uwgIyD5OLgwqCPN-2">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="660" y="110" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-6" value="struct{&lt;br&gt;BusinessId&lt;br&gt;StaffId&lt;br&gt;LeadsUuid&lt;br&gt;LeadsId&lt;br&gt;LeadsState&lt;br&gt;TrackDesc（备注使用）&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="700" y="30" width="190" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-8" target="Liaz7uwgIyD5OLgwqCPN-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-8" value="从分配任务中获取预期值&lt;br&gt;PreSetNum" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="497.5" y="140" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-10" target="Liaz7uwgIyD5OLgwqCPN-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-10" value="for分批处理&lt;br&gt;判断presetnum&amp;lt;分片数processNum，分片初始0&lt;br&gt;maxid，初始0，之后记录线索切片列表的最后一个线索id" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="410" y="190" width="313.75" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-13" target="Liaz7uwgIyD5OLgwqCPN-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-13" value="获取状态是分配中线索，根据预设值和分片值得差值取值，最大取1000条线索，查询第一页，第（差值）条线索，&lt;br&gt;表：leads_public 下面细节" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="405.13" y="260" width="323.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-15" target="Liaz7uwgIyD5OLgwqCPN-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-15" value="获取两个结果&lt;br&gt;LeadsIds []int64&lt;br&gt;leadsMap [线索id]线索详情" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="487.81" y="330" width="149.69" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-16" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;查询leads_public表&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;（线索id）id&amp;gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;maxid（初始是0）且&lt;/span&gt;&lt;/div&gt;&lt;span&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;business_id=线索任务结果的组织&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;且&lt;/span&gt;&lt;span&gt;tag_id=&lt;/span&gt;&lt;span&gt;线索任务结果的tag_id&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;&lt;span&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;且状态state=分配中 （7），按照id升序查&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="780" y="240" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-17" value="" style="endArrow=classic;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.475;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-16" target="Liaz7uwgIyD5OLgwqCPN-13">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="750" y="310" as="sourcePoint" />
            <mxPoint x="800" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-19" target="Liaz7uwgIyD5OLgwqCPN-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-19" target="Liaz7uwgIyD5OLgwqCPN-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-19" value="&lt;span&gt;maxid赋值&lt;/span&gt;LeadsIds最后一个线索id&lt;br&gt;分片数processNum累加LeadsIds数量" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="459.15" y="400" width="207" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.436;entryY=-0.017;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-21" target="Liaz7uwgIyD5OLgwqCPN-26">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="700" />
              <mxPoint x="555" y="700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-21" value="遍历LeadsIds&lt;br&gt;逐个追加到saveLeadsList&lt;br&gt;1、每100个线索id追加到saveLeadsList的LeadsId&lt;br&gt;2、saveLeadsList的state更新为2（分配至小公海）" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="490" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-23" target="Liaz7uwgIyD5OLgwqCPN-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-23" target="Liaz7uwgIyD5OLgwqCPN-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-23" value="遍历leadsMap" style="rounded=1;whiteSpace=wrap;html=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="666.15" y="490" width="130" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-26" target="Liaz7uwgIyD5OLgwqCPN-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="200" y="790" />
              <mxPoint x="200" y="215" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.433;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-26" target="Liaz7uwgIyD5OLgwqCPN-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-26" value="保存" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="503" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-30" value="不断循环直到不满足&lt;br&gt;&lt;span style=&quot;text-align: left&quot;&gt;presetnum&amp;lt;分片数processNum&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="20" y="380" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.436;entryY=-0.05;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-32" target="Liaz7uwgIyD5OLgwqCPN-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-32" value="判断线索类型是不是”供销电商“&lt;br&gt;线索追加到publicIds(map)中&lt;br&gt;e.g:map[businessid]线索id" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="580" width="175" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.436;entryY=-0.083;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-35" target="Liaz7uwgIyD5OLgwqCPN-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-35" value="&lt;span style=&quot;text-align: left&quot;&gt;逐个追加到&lt;/span&gt;&lt;span&gt;leadsFlowList&lt;/span&gt;&lt;br style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;text-align: left&quot;&gt;1、&lt;/span&gt;leadsFlowList&lt;span style=&quot;text-align: left&quot;&gt;的state更新为2（分配至小公海）&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="580" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-39" target="Liaz7uwgIyD5OLgwqCPN-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-39" value="处理结果：&lt;span&gt;publicIds，&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: left&quot;&gt;saveLeadsList，&lt;/span&gt;&lt;span&gt;leadsFlowList&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="697.5" y="775" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-41" value="传参" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="642.5" y="760" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Liaz7uwgIyD5OLgwqCPN-42" target="Liaz7uwgIyD5OLgwqCPN-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-42" value="叠加（更新线索数量）到actualNum(执行分配数量)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="511" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-44" value="返回更新leads_public线索数量" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="572.5" y="840" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-45" value="更新leads_assign_record&lt;br&gt;表" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="510" y="970" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Liaz7uwgIyD5OLgwqCPN-47" value="查询分配线索表的id且&lt;br&gt;状态是1(已提交待执行)的分配任务&lt;br&gt;更新他的分配时间（assignAt）&lt;br&gt;和状态（state=2 执行成功）,&lt;br&gt;实际分配的数量（&lt;span&gt;actualNum）&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="677.5" y="960" width="200" height="80" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
