<mxfile host="app.diagrams.net" modified="2021-01-10T06:18:30.095Z" agent="5.0 (Macintosh; Intel Mac OS X 11_1_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36" etag="9WXrvoE0gOxLC_Ye2nAQ" version="14.1.8" type="github">
  <diagram id="KY8PMSi8VeK6j9uEWK3R" name="Page-1">
    <mxGraphModel dx="946" dy="646" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="1920" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="M7u62a-sFAjZS3G1px5h-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-1" target="M7u62a-sFAjZS3G1px5h-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-1" value="大公海小公海到私海" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-2" target="M7u62a-sFAjZS3G1px5h-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-2" value="定义四个变量&lt;br&gt;saveLeadsList 切片值为SaveLeadsAccountRecord&lt;br&gt;leadsFlowList 切片值为InsertLeadsFlow&lt;br&gt;extendsIns&amp;nbsp; 线索分配任务的extend字段" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="70" width="280" height="77.5" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.011;entryY=0.426;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-4" target="M7u62a-sFAjZS3G1px5h-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-4" value="struct{&lt;br&gt;StaffId&lt;br&gt;State&lt;br&gt;LeadsId&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="170" y="70" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1.007;entryY=0.619;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-5" target="M7u62a-sFAjZS3G1px5h-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-5" value="struct{&lt;br&gt;BusinessId&lt;br&gt;StaffId&lt;br&gt;LeadsUuid&lt;br&gt;LeadsId&lt;br&gt;LeadsState&lt;br&gt;TrackDesc（备注使用）&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="650" y="68" width="190" height="100" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-8" target="M7u62a-sFAjZS3G1px5h-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-8" value="struct{&lt;br&gt;Urge&lt;br&gt;Single&lt;br&gt;StaffList&lt;br&gt;Bind&lt;br&gt;BindPool&lt;br&gt;TagIds&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="60" y="170" width="190" height="100" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-10" target="M7u62a-sFAjZS3G1px5h-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-10" value="使用任务info赋值l&lt;span style=&quot;text-align: left&quot;&gt;eadsAssign&lt;br&gt;结构体的task字段&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="370" y="170" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-12" target="M7u62a-sFAjZS3G1px5h-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-12" value="&amp;nbsp;根据tagId获取线索分组信息&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="378.75" y="230" width="162.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-14" target="M7u62a-sFAjZS3G1px5h-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-14" value="&lt;div&gt;select&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; b.id as id , b.name as name ,&lt;/div&gt;&lt;div&gt;b.business_id as business_id ,&amp;nbsp;&lt;/div&gt;&lt;div&gt;b.leads_type as leads_type&lt;/div&gt;&lt;div&gt;from&amp;nbsp;&lt;/div&gt;&lt;div&gt;tag_attr as a ,&amp;nbsp; tag_group&amp;nbsp; as b&lt;/div&gt;&lt;div&gt;where&amp;nbsp;&lt;/div&gt;&lt;div&gt;b.id = a.group_id and a.id = tagid&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="610" y="185" width="190" height="120" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-15" target="M7u62a-sFAjZS3G1px5h-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-15" value="获取待分配线索总数和待分配坐席信息切片列表" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="375" y="280" width="170" height="35" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-17" target="M7u62a-sFAjZS3G1px5h-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-17" value="需要参数：分配任务中的tagid对应的线索类型&lt;br&gt;分配任务中extend&lt;br&gt;分配任务&lt;br&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="290" width="260" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-19" target="M7u62a-sFAjZS3G1px5h-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-19" target="M7u62a-sFAjZS3G1px5h-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-19" value="判断分配任务中extend中是否含有Urge且为真" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="395" y="340" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-21" target="M7u62a-sFAjZS3G1px5h-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-21" value="鼓励模式" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="320" y="420" width="121.25" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.415;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-22" target="M7u62a-sFAjZS3G1px5h-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-22" value="普通模式" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="770" y="420" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-25" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="380" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-26" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="490" y="380" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-28" target="M7u62a-sFAjZS3G1px5h-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-28" value="&lt;div&gt;&amp;nbsp;//坐席信息&lt;/div&gt;&lt;div&gt;type StaffScore struct {&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;BusinessId&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;StaffId&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;Score&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;Fill&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//剩余分配数量&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;WaitAssign //待分配线索id集合&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;BindAssign&amp;nbsp; &amp;nbsp; //管家分的线索&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;AverageAssign //平均分的线索&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;OrderAssign&amp;nbsp; &amp;nbsp;//顺序分的线索&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="345" width="180" height="170" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-30" target="M7u62a-sFAjZS3G1px5h-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-30" value="遍历分配任务中extend里的stafflist(坐席列表)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="310.62" y="460" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.433;entryY=-0.033;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-32" target="M7u62a-sFAjZS3G1px5h-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-32" value="设置坐席信息中组织id为分配任务的组织id" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="320" y="515" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-74" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-34">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="520" y="1040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-34" value="获取分配任务中extend里&lt;br&gt;每个坐席待分配线索数(fill),叠加获取总的待分配线索总数&lt;br&gt;保存每个坐席对应信息到staffList&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="290" y="580" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-62" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-35" target="M7u62a-sFAjZS3G1px5h-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-35" value="&lt;div&gt;staffList = make(map[int64]mysql.StaffScore)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="10" y="595" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.608;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-37" target="M7u62a-sFAjZS3G1px5h-39">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-37" value="获取可接单坐席列表&lt;br&gt;通过分配任务中组织id和线索列表" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="460" width="190" height="35" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.35;entryY=-0.017;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-39" target="M7u62a-sFAjZS3G1px5h-44">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-39" value="grpc查询GetStaffInfoByParams" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="710" y="520" width="250" height="35" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-41" target="M7u62a-sFAjZS3G1px5h-39">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-41" value="参数：&lt;br&gt;1、在职状态 state=1&lt;br&gt;2、组织id =分配任务的组织id&lt;br&gt;3、线索类型如果不等于0，需要通过线索类型获取工作台开关&lt;br&gt;receive&amp;nbsp; &amp;nbsp;&amp;nbsp;客服工作台接单开关字段&lt;br&gt;&lt;div&gt;telemarketing_receive_state&amp;nbsp;&lt;span&gt;电销工作台接单开关字段&lt;/span&gt;&lt;/div&gt;&lt;div&gt;monitor_receive_state&amp;nbsp;&lt;span&gt;回访工作台接单开关字段&lt;br&gt;&lt;/span&gt;4、一次取三百&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1030" y="462.5" width="340" height="150" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-42" value="&lt;div&gt;线索类型&lt;/div&gt;&lt;div&gt;LeadsTypePublic&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= 1&amp;nbsp; //共建电销&lt;/div&gt;&lt;div&gt;LeadsTypeInsurance&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = 2&amp;nbsp; //保司服务&lt;/div&gt;&lt;div&gt;LeadsTypeReturnVisit&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; = 3&amp;nbsp; //微爱回访类型&lt;/div&gt;&lt;div&gt;LeadsTypeCallSale&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;= 4&amp;nbsp; //电销类型&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="970" y="260" width="270" height="90" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.642;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-44" target="M7u62a-sFAjZS3G1px5h-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-44" value="循环取出坐席id列表" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="810" y="580" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-46" target="M7u62a-sFAjZS3G1px5h-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-46" value="&lt;span&gt;获取总的待分配线索总数&lt;/span&gt;&lt;br&gt;&lt;span&gt;保存每个坐席对应信息到staffList&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="710" y="630" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-48" target="M7u62a-sFAjZS3G1px5h-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-48" value="传参：&lt;br&gt;1、线索分配任务的extend中的tagids&lt;br&gt;2、线索分配任务的tag_id（之前有查询条件，但是注释了）&lt;br&gt;3、线索列表&lt;br&gt;4、线索分配任务的extend中的single(每个人线索数)&lt;br&gt;5、线索分配任务的组织id" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="600" width="330" height="90" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-50" target="M7u62a-sFAjZS3G1px5h-53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-50" value="初始化坐席信息结构体为值，保存以坐席id为key的map" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="745" y="680" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-51" value="&lt;div&gt;&lt;span&gt;	&lt;/span&gt;staffScoreMap = make(map[int64]mysql.StaffScore)&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="690" width="290" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-53" target="M7u62a-sFAjZS3G1px5h-56">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-53" value="拼接查询条件 whereParams" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="748.75" y="740" width="161.25" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-55" target="M7u62a-sFAjZS3G1px5h-53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-55" value="条件：&lt;br&gt;1、business_id=线索分配任务的组织id&lt;br&gt;2、staff_id=要查询的线索列表&lt;br&gt;3、tag_id in(extend中的tag_id)&lt;br&gt;4、state in(3,4,5,6,7)状态代表有线索分配&lt;br&gt;分配至私海，已成交，跟进中，丢单，分配中&lt;br&gt;5、dispatched_at = 当天日期" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="950" y="685" width="260" height="100" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-56" target="M7u62a-sFAjZS3G1px5h-64">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-56" value="批量查询leads_public" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="770" y="780" width="120" height="25" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-58" target="M7u62a-sFAjZS3G1px5h-56">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-58" value="&lt;div&gt;// 如果 whereParams[&quot;staff_id&quot;]存在，5组，&lt;/div&gt;&lt;div&gt;每组10个staff信息拼接查询条件，循环条件添加staff_id&lt;/div&gt;&lt;div&gt;（最后不够10个也追加），&lt;span&gt;追加到staffIdGroup&lt;/span&gt;&lt;/div&gt;&lt;div&gt;// 如果 whereParams[&quot;staff_id&quot;]不存在，追加到staffIdGroup&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="762.5" width="330" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-64" target="M7u62a-sFAjZS3G1px5h-66">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-64" value="按照staff_id分组，根据&lt;span style=&quot;text-align: left&quot;&gt;staffIdGroup每个where&lt;/span&gt;&lt;br&gt;查询，获取count(1)(分数)，分数按照升序排序" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="697.19" y="827.5" width="265.62" height="32.5" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-66" target="M7u62a-sFAjZS3G1px5h-68">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-66" value="每个坐席信息（&lt;span style=&quot;text-align: left&quot;&gt;StaffScore结构体）&lt;/span&gt;追加到staffList&amp;nbsp;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="688.47" y="880" width="283.06" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-68">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="520" y="1040" as="targetPoint" />
            <Array as="points">
              <mxPoint x="830" y="1020" />
              <mxPoint x="520" y="1020" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-68" value="遍历坐席信息列表&lt;br&gt;1、如果坐席的线索已满，从坐席列表移除，查看下一个坐席&lt;br&gt;2、如果分数小于分配任务中extend里的singel(每个坐席应分配的线索)&lt;br&gt;3、修改该坐席信息Fill字段（还需要分配线索数）&lt;br&gt;4、同时记录以坐席id为key，以坐席信息为值 保存在map&lt;br&gt;遍历上面待分配线索的坐席信息map&amp;nbsp; &amp;nbsp;获取需要分配的总线索" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="620.7" y="920" width="419.3" height="90" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-72" value="注：奖励的线索通过任务extend中获取fill" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="535" width="230" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-76" target="M7u62a-sFAjZS3G1px5h-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-76" value="for分批处理&lt;br&gt;判断presetnum&amp;lt;分片数processNum，分片初始0&lt;br&gt;maxid，初始0，之后记录线索切片列表的最后一个线索id" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="370" y="1040" width="313.75" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-82" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-77" target="M7u62a-sFAjZS3G1px5h-81">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-77" value="获取状态是分配中线索，根据预设值和分片值得差值取值，最大取1000条线索，查询第一页，第（差值）条线索，&lt;br&gt;表：leads_public 下面细节" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="364.96999999999997" y="1110" width="323.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-80" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-79" target="M7u62a-sFAjZS3G1px5h-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-79" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;查询leads_public表&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;（线索id）id&amp;gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;maxid（初始是0）且&lt;/span&gt;&lt;/div&gt;&lt;span&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;business_id=线索任务结果的组织&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;且&lt;/span&gt;&lt;span&gt;tag_id=&lt;/span&gt;&lt;span&gt;线索任务结果的tag_id&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;&lt;span&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;且状态state=分配中 （7），按照id升序查&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="1070" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-84" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-81" target="M7u62a-sFAjZS3G1px5h-83">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-81" value="获取两个结果&lt;br&gt;LeadsIds []int64&lt;br&gt;leadsMap [线索id]线索详情" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="452.03" y="1180" width="149.69" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-86" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-83" target="M7u62a-sFAjZS3G1px5h-85">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-83" value="&lt;span&gt;maxid赋值&lt;/span&gt;LeadsIds最后一个线索id&lt;br&gt;分片数processNum累加LeadsIds数量" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="423.37" y="1250" width="207" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-90" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-85" target="M7u62a-sFAjZS3G1px5h-87">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1410" y="380" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-85" target="M7u62a-sFAjZS3G1px5h-88">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-85" value="判断是否管家分配&lt;br&gt;根据分配任务的extend里的bind字段是否true" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="401.72" y="1320" width="248.28" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-87" target="M7u62a-sFAjZS3G1px5h-93">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-87" value="管家模式" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1690" y="30" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-88" value="普通模式" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2240" y="30" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-99" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-93" target="M7u62a-sFAjZS3G1px5h-98">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-93" value="调用bindAssign方法" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1670" y="68" width="110" height="22" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-96" target="M7u62a-sFAjZS3G1px5h-93">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-96" value="参数：&lt;br&gt;1、分配任务中的extend里的bindpool&lt;br&gt;2、分配中的线索信息map&lt;br&gt;3、待分配staffid切片列表&lt;br&gt;4、分配任务id&lt;br&gt;返回 （下面定义需要验证）&lt;br&gt;1、freeids 剩余自由线索（分配下去）&lt;br&gt;2、bindIds 剩余已被其他坐席绑定的线索&lt;br&gt;（还原到小公海）&lt;br&gt;3、staffList 本次分配线索已绑定客户线索" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1380" y="10" width="230" height="150" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-101" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-98" target="M7u62a-sFAjZS3G1px5h-100">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-98" value="离职坐席解绑缓存 redis" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1652.5" y="107.5" width="147.5" height="22.5" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-108" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.414;entryY=-0.133;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-100" target="M7u62a-sFAjZS3G1px5h-105">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-100" value="redis 获取最近一次获取离职信息时间" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1624.25" y="147.5" width="204" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-103" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-102" target="M7u62a-sFAjZS3G1px5h-100">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-102" value="zset 按照分数（时间戳）排序 &lt;br&gt;key :&amp;nbsp;leads:staff_leave_list:sorted-set" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1380" y="170" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-113" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-105" target="M7u62a-sFAjZS3G1px5h-112">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-105" value="获取staff用户信息列表&amp;nbsp; mysql表：crm_user" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1670" y="200" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-107" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-106" target="M7u62a-sFAjZS3G1px5h-105">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-106" value="查询条件：&lt;br&gt;state=2(离职)&lt;br&gt;update_at&amp;gt;最近一次获取离职信息时间&lt;br&gt;离职staffid列表" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1385" y="205" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-111" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-109" target="M7u62a-sFAjZS3G1px5h-105">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-109" value="&lt;div&gt;坐席信息&lt;/div&gt;&lt;div&gt;type CrmUser struct {&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;Id&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;int64&amp;nbsp; `gorm:&quot;column:id&quot;`&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;Name&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;string `gorm:&quot;column:name&quot;`&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;Account&amp;nbsp; &amp;nbsp; string `gorm:&quot;column:account&quot;`&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;BusinessId int64&amp;nbsp; `gorm:&quot;column:business_id&quot;`&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1380" y="280" width="260" height="100" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-115" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-112" target="M7u62a-sFAjZS3G1px5h-114">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-117" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-112" target="M7u62a-sFAjZS3G1px5h-116">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-112" value="&lt;div&gt;遍历离职坐席列表&lt;/div&gt;&lt;div&gt;移除坐席绑定的客户缓存&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1670" y="250" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-114" value="Zset&lt;br&gt;key :&amp;nbsp;leads:(extend中bindpool):sorted-set" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1828.25" y="255" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-119" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-116" target="M7u62a-sFAjZS3G1px5h-118">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-116" value="加入离职缓存 redis zset:&lt;br&gt;&lt;span&gt;key :&amp;nbsp;leads:staff_leave_list:sorted-set&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1640" y="340" width="200" height="35" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-118" target="M7u62a-sFAjZS3G1px5h-122">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-118" value="分配坐席挑选线索&lt;br&gt;调用：GetStaffBoundLeadsIds" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1652.5" y="390" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-121" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-120">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1650" y="405" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-120" value="参数：&lt;br&gt;1、待分配(分配中)线索详情列表&lt;br&gt;2、分配线索任务组织id&lt;br&gt;3、分配线索任务id" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1450" y="375" width="190" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-125" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-122" target="M7u62a-sFAjZS3G1px5h-124">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-122" value="遍历分配中的线索&amp;nbsp; 初始化一下变量&lt;br&gt;1、phones 逐个追加&lt;br&gt;2、phonemap[phoneid]=qscid 逐个save&lt;br&gt;3、qscphoneleadsIds[phoneid]=线索id&lt;br&gt;4、qscids 逐个追加&lt;br&gt;5、leadsidmap[线索id]=qscid 逐个save&lt;br&gt;6、phoneleadsuuidmap[phoneid]=线索对应uuid&lt;br&gt;7、phonetagidmap[phoneid]=线索对应tagid" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1600.63" y="435" width="273.75" height="125" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-129" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-124" target="M7u62a-sFAjZS3G1px5h-128">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-124" value="获取第一管家&lt;br&gt;调用checkBindByStaffAttach" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1657.5" y="580" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-127" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-126" target="M7u62a-sFAjZS3G1px5h-124">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-126" value="传参：&lt;br&gt;1、phonesmap&lt;br&gt;2、leadsIDmap" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1445" y="570" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-134" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-128" target="M7u62a-sFAjZS3G1px5h-132">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-128" value="遍历&lt;span&gt;leadsIDmap&amp;nbsp;初始化变量&lt;br&gt;&lt;div&gt;uniQscId[int64(qscId)] = struct{}{}&lt;/div&gt;&lt;div&gt;qscIdLeadsIdMap[qscId] = leadsId&lt;/div&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1625.76" y="625" width="223.49" height="45" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-136" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-132" target="M7u62a-sFAjZS3G1px5h-135">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-132" value="遍历uniQscId，获取qscIdlist切片reqid&lt;br&gt;qscId列表分组每100个一组，分多组赋值：reqIdGroups" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1618.88" y="685" width="237.25" height="45" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-140" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-135" target="M7u62a-sFAjZS3G1px5h-139">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-135" value="遍历reqIdGroups，分批查询grpc(GetStaffByQscId)&amp;nbsp;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1645.5" y="745" width="172" height="35" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-138" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-137" target="M7u62a-sFAjZS3G1px5h-135">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-137" value="查询条件：&lt;br&gt;1、Rank:1&lt;br&gt;2、QscId:qscid" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1445" y="738" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-141" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-139" target="M7u62a-sFAjZS3G1px5h-135">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-143" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-139">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1731" y="890" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-139" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;上面会有多个，只取第一个&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;staffList := GetStaffByQscIdResponse.List&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;staffInfo := staffList[0]&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;保存在QscIdStaffKeyMap[qscid]=staffInfo.StaffKey&amp;nbsp;&lt;span&gt;绑定关系了&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1562.8100000000002" y="800" width="337.37" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-142" value="循环" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1920" y="788" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-144" value="循环完" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1730" y="860" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-150" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-145" target="M7u62a-sFAjZS3G1px5h-148">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-145" value="遍历phonesMap" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1672" y="890" width="118" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-147" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-146" target="M7u62a-sFAjZS3G1px5h-145">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-146" value="&lt;div&gt;QscIdStaffKeyMap[v] != &quot;&quot;&lt;/div&gt;&lt;div&gt;&lt;span&gt;因为可能比&lt;/span&gt;&lt;/div&gt;&lt;span&gt;phonesMap少&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1460" y="875" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-154" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-148" target="M7u62a-sFAjZS3G1px5h-152">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-148" value="循环查询crm_user表 根据account=phonesMap的value&lt;br&gt;获取用户信息,取一条" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1645.5" y="940" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-151" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-149" target="M7u62a-sFAjZS3G1px5h-148">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-149" value="注：&lt;span&gt;account以后要代替staffid&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1448.88" y="950" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-156" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.471;entryY=0.033;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-152" target="M7u62a-sFAjZS3G1px5h-155">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-152" value="call-&amp;gt;CheckStaffLeave&lt;br&gt;获取坐席在职状态&lt;br&gt;redis" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1656.5" y="1000" width="148" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-164" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-153" target="M7u62a-sFAjZS3G1px5h-152">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-153" value="参数：&lt;br&gt;上一个userinfo的id" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1480.63" y="1010" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-157" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-155" target="M7u62a-sFAjZS3G1px5h-145">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-163" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-155" target="M7u62a-sFAjZS3G1px5h-160">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-155" value="在职，逐个绑定&lt;br&gt;bound[phoneid] = userInfo[0].Id" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1643.5" y="1070" width="188" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-158" value="循环" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1849.25" y="970" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-166" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-160" target="M7u62a-sFAjZS3G1px5h-165">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-160" value="返回staffAttachBound&lt;br&gt;1、staffAttachBound 在phonesMap中过滤，&lt;br&gt;2、再重新循环phonesMap，获取手机号切片&lt;span style=&quot;text-align: center&quot;&gt;phones&lt;/span&gt;列表" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1578.53" y="1120" width="305.94" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-170" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-165" target="M7u62a-sFAjZS3G1px5h-169">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-165" value="获取历史分配call-&amp;gt;checkBindByAssign" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1621.51" y="1190" width="218" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-168" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-167" target="M7u62a-sFAjZS3G1px5h-165">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-167" value="参数：&lt;br&gt;phones, businessId, &lt;br&gt;phoneLeadsUUIDMap, &lt;br&gt;phoneTagIDMap&lt;br&gt;返回&lt;br&gt;&lt;div&gt;assignBound,&amp;nbsp;&lt;/div&gt;&lt;div&gt;predictCallBound,&amp;nbsp;&lt;/div&gt;&lt;div&gt;predictCallPhoneLeadsUUIds&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1430" y="1135" width="170" height="130" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-176" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-169" target="M7u62a-sFAjZS3G1px5h-175">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-169" value="遍历&lt;span style=&quot;text-align: left&quot;&gt;phones&lt;br&gt;每100查询一次leads_public&lt;br&gt;获取leadsList&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1641.01" y="1230" width="193" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-173" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-171" target="M7u62a-sFAjZS3G1px5h-169">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-171" value="条件：&lt;br&gt;1、state in(3,4,5,6)&lt;br&gt;已分配至私海,已成交,跟进中,丢单" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1420" y="1265" width="190" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-185" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-174" target="M7u62a-sFAjZS3G1px5h-183">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-174" value="获取第一个坐席id是否离职" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1600" y="1350" width="150" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-177" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-175" target="M7u62a-sFAjZS3G1px5h-174">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-180" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-175" target="M7u62a-sFAjZS3G1px5h-179">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-175" value="&lt;span style=&quot;text-align: left&quot;&gt;len(leadsList)&amp;gt;0?&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1676.5" y="1290" width="122" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-178" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1672" y="1310" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-196" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.558;entryY=-0.033;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-179" target="M7u62a-sFAjZS3G1px5h-195">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-179" value="&lt;span&gt;使用phoneTagIDMap通过线索对应phoneid,找到common.TRCallTags中是否这个tagid,、存在则默认&lt;br&gt;&lt;/span&gt;&lt;span&gt;赋值预测外呼：&lt;/span&gt;&lt;br&gt;&lt;div&gt;predictCallPhones[Phone] = 0&lt;/div&gt;&lt;div&gt;predictCallPhoneLeadsUUIds[Phone] = phoneLeadsUUIDMap通过手机号获取uuid&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1798.5" y="1350" width="341.75" height="90" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-181" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1765" y="1310" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-186" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-183" target="M7u62a-sFAjZS3G1px5h-184">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-183" value="使用phoneTagIDMap通过线索对应phoneid,找到common.TRCallTags中是否这个tagid,不存在则默认存入以phoneid为key,以坐席id为值得bound中" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1517.81" y="1390" width="270" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-191" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-184" target="M7u62a-sFAjZS3G1px5h-190">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-184" value="如果上面存在，&lt;br&gt;&lt;div&gt;&lt;span&gt;获取当前时间和线索列表中线索的分配时间，判断是否小于等于60天，默认存入以phoneid为key,以坐席id为值得bound中&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1540" y="1460" width="225" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-188" value="存在" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1655" y="1440" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-194" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=-0.006;entryY=0.715;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-190" target="M7u62a-sFAjZS3G1px5h-167">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-197" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.558;entryY=-0.017;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-190" target="M7u62a-sFAjZS3G1px5h-195">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-190" value="赋值预测外呼：&lt;br&gt;&lt;div&gt;predictCallPhones[Phone] = StaffId&lt;/div&gt;&lt;div&gt;predictCallPhoneLeadsUUIds[Phone] = UuId&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1540" y="1550" width="240" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-192" value="大于60天" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1656.5" y="1520" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-201" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-195" target="M7u62a-sFAjZS3G1px5h-200">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-195" value="&lt;span style=&quot;text-align: left&quot;&gt;遍历assignBound，依次&lt;/span&gt;存入缓存" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1769.25" y="1640" width="190.75" height="20" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-199" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-198" target="M7u62a-sFAjZS3G1px5h-195">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-198" value="Zset&lt;br&gt;key :&amp;nbsp;leads:(extend中bindpool):sorted-set" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="1472" y="1630" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-203" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.478;entryY=-0.029;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="M7u62a-sFAjZS3G1px5h-200" target="M7u62a-sFAjZS3G1px5h-202">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-200" value="返回assignBound&lt;br&gt;1、assignBound&amp;nbsp;在phonesMap中过滤，&lt;br&gt;2、再重新循环phonesMap，获取手机号切片&lt;span style=&quot;text-align: center&quot;&gt;phones&lt;/span&gt;列表" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1711.66" y="1680" width="305.94" height="50" as="geometry" />
        </mxCell>
        <mxCell id="M7u62a-sFAjZS3G1px5h-202" value="遍历phone(还没有绑定关系的线索uuid和phone映射关系)&lt;br&gt;逐个赋值&lt;span&gt;phoneLeadsUUIDMapAfterCheckAssign[QscPhone(v)] = phoneLeadsUUIDMap[QscPhone(v)]&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1706.0600000000002" y="1750" width="326.37" height="70" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
