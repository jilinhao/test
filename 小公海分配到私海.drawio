<mxfile host="app.diagrams.net" modified="2021-01-09T15:21:10.945Z" agent="5.0 (Macintosh; Intel Mac OS X 11_1_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36" etag="ShqDcDKHeLGQXA-RKp_9" version="14.1.8" type="github">
  <diagram id="we1jSzhgWFrd1LfGBv2H" name="Page-1">
    <mxGraphModel dx="2146" dy="646" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="1920" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-1" target="AKi_2DA1NPzy-PJfhwJz-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-1" value="小公海到私海" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-5" target="AKi_2DA1NPzy-PJfhwJz-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-5" value="struct{&lt;br&gt;StaffId&lt;br&gt;State&lt;br&gt;LeadsId&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="170" y="70" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-6" target="AKi_2DA1NPzy-PJfhwJz-36">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-6" value="定义四个变量&lt;br&gt;saveLeadsList 切片值为SaveLeadsAccountRecord&lt;br&gt;leadsFlowList 切片值为InsertLeadsFlow&lt;br&gt;extendsIns&amp;nbsp; 线索分配任务的extend字段" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="81.25" width="280" height="77.5" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.011;entryY=0.6;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-11" target="AKi_2DA1NPzy-PJfhwJz-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-11" value="struct{&lt;br&gt;BusinessId&lt;br&gt;StaffId&lt;br&gt;LeadsUuid&lt;br&gt;LeadsId&lt;br&gt;LeadsState&lt;br&gt;TrackDesc（备注使用）&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="660" y="70" width="190" height="100" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-14" target="AKi_2DA1NPzy-PJfhwJz-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-14" value="struct{&lt;br&gt;Urge&lt;br&gt;Single&lt;br&gt;StaffList&lt;br&gt;Bind&lt;br&gt;BindPool&lt;br&gt;TagIds&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="190" width="190" height="100" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.469;entryY=-0.04;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-17" target="AKi_2DA1NPzy-PJfhwJz-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-17" value="从分配任务中获取预期值&lt;br&gt;PreSetNum" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="390" y="300" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-19">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460.99" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-19" value="for分批处理&lt;br&gt;判断presetnum&amp;lt;分片数processNum，分片初始0&lt;br&gt;maxid，初始0，之后记录线索切片列表的最后一个线索id" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="313" y="350" width="313.75" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" target="AKi_2DA1NPzy-PJfhwJz-27">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460.99" y="480" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-22" value="获取状态是分配中线索，根据预设值和分片值得差值取值，最大取1000条线索，查询第一页，第（差值）条线索，&lt;br&gt;表：leads_public 下面细节" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="291.25" y="430" width="321.75" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-27" target="AKi_2DA1NPzy-PJfhwJz-29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-27" value="获取两个结果&lt;br&gt;LeadsIds []int64&lt;br&gt;leadsMap [线索id]线索详情" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="386.14000000000004" y="500" width="149.69" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-29" target="AKi_2DA1NPzy-PJfhwJz-39">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-29" value="&lt;span&gt;maxid赋值&lt;/span&gt;LeadsIds最后一个线索id&lt;br&gt;分片数processNum累加LeadsIds数量" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="357.48" y="570" width="202.52" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-31" target="AKi_2DA1NPzy-PJfhwJz-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-31" value="从分配任务中获取extend值解析赋值到&lt;span style=&quot;text-align: left&quot;&gt;extendsIns&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="390.88" y="250" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-35" value="&lt;div&gt;type leadsAssign struct {&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;sync.Once&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;logCategory string&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;logIns&amp;nbsp; &amp;nbsp; &amp;nbsp; glog.BaseLog&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;stopChan&amp;nbsp; &amp;nbsp; chan string&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;lock&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; sync.Mutex&lt;/div&gt;&lt;div&gt;&lt;span&gt;	&lt;/span&gt;task&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mysql.AssignTaskRecord //为了下层函数获取参数&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="-85" y="340" width="330" height="120" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-36" target="AKi_2DA1NPzy-PJfhwJz-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-36" value="使用任务info赋值l&lt;span style=&quot;text-align: left&quot;&gt;eadsAssign&lt;br&gt;结构体的task字段&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="370" y="190" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-39" target="AKi_2DA1NPzy-PJfhwJz-41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-39" value="遍历&lt;span style=&quot;text-align: left&quot;&gt;LeadsIds&lt;/span&gt;分配中的线索" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="376.99" y="630" width="163.5" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-41" target="AKi_2DA1NPzy-PJfhwJz-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-41" value="初始化分配标记为true&lt;br&gt;assignToPrivateSeaFlag" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="378.35" y="670" width="160.77" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-43" target="AKi_2DA1NPzy-PJfhwJz-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-43" value="通过线索id获取线索id对应的坐席id，redis查询" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="368.11" y="720" width="181.89" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-45" value="key:&amp;nbsp; leads:LeadsStaffId:线索id" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="580" y="730" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-46" target="AKi_2DA1NPzy-PJfhwJz-48">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-46" target="AKi_2DA1NPzy-PJfhwJz-49">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-46" value="是否可以查询出坐席id" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="389.37" y="780" width="141.26" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-48" target="AKi_2DA1NPzy-PJfhwJz-54">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-48" value="线索id转码&lt;br&gt;（失败会追加线索到还原切片&lt;br&gt;标记assignToPrivateSeaFlag设置false）" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="270" y="860" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-49" target="AKi_2DA1NPzy-PJfhwJz-54">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-49" value="&lt;span&gt;标记assignToPrivateSeaFlag设置false,追加线索到还原切片&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="515" y="860" width="185" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-51" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="335" y="810" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-53" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="810" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-54" target="AKi_2DA1NPzy-PJfhwJz-58">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-54" target="AKi_2DA1NPzy-PJfhwJz-60">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-54" value="根据线索id从reids删除线索id和坐席id的绑定关系" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="410" y="970" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-57" value="key:&amp;nbsp; leads:LeadsStaffId:线索id" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="595" y="985" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-58" target="AKi_2DA1NPzy-PJfhwJz-63">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-58" value="每一个线索信息，填充SaveLeadsAccountRecord结构体（更新状态为3，分配到私海），并追加分配线索到leadsFlowList切片" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="200" y="1060" width="250" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-60">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="480" y="1170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-60" value="每一个线索信息，填充InsertLeadsFlow结构体（更新状态为3，分配到私海&lt;br&gt;）&lt;br&gt;，并追加分配线索到leadsFlowList切片" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="1060" width="255" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-63" target="AKi_2DA1NPzy-PJfhwJz-67">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-63" value="保存" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="419" y="1170" width="121" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-67">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="479" y="1300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-67" value="&lt;span style=&quot;text-align: left&quot;&gt;saveLeadsList数量&amp;gt;0&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="419" y="1220" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-70" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="485" y="1270" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-71" target="AKi_2DA1NPzy-PJfhwJz-74">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-71" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;font face=&quot;helvetica&quot;&gt;执行分配&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="415.83" y="1300" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-77" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-74" target="AKi_2DA1NPzy-PJfhwJz-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-74" value="查询id in(&lt;span style=&quot;text-align: left&quot;&gt;saveLeadsList&lt;/span&gt;)且状态（state）是分配中的线索&lt;br&gt;更新这一批线索状态(state)，组织(businessid)，坐席(staffis)，分配数+1(dispatchedCount+1)，分配时间(dispatchedAt)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="324" y="1350" width="310" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-76" target="AKi_2DA1NPzy-PJfhwJz-78">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-76" value="返回线索数量" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="416" y="1430" width="124" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-81" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-78" target="AKi_2DA1NPzy-PJfhwJz-80">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-78" value="&lt;span&gt;判断还原线索是否bindIds&amp;gt;0&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="419.49" y="1470" width="121" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-84" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-80" target="AKi_2DA1NPzy-PJfhwJz-83">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-80" value="查询还原索引id且状态是分配中的线索，每100分组还原到小公海，设置state=2，更新表leads_public" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="384.99" y="1530" width="190" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-82" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="485" y="1510" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-86" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-83" target="AKi_2DA1NPzy-PJfhwJz-85">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-83" value="leadsFlowList&lt;span style=&quot;text-align: left&quot;&gt;数量&amp;gt;0&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="419.99" y="1610" width="120.01" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-88" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.435;entryY=-0.067;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-85" target="AKi_2DA1NPzy-PJfhwJz-87">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-85" value="批量(100个一组)插入流转表&lt;br&gt;leads_flow_record" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="404.99" y="1660" width="150.01" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="AKi_2DA1NPzy-PJfhwJz-87" target="AKi_2DA1NPzy-PJfhwJz-89">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-87" value="叠加（更新线索数量）到actualNum(执行分配数量)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="410" y="1710" width="161" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-89" value="更新leads_assign_record表" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="405" y="1770" width="155" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AKi_2DA1NPzy-PJfhwJz-90" value="查询分配线索表的id且&lt;br&gt;状态是1(已提交待执行)的分配任务&lt;br&gt;更新他的分配时间（assignAt）&lt;br&gt;和状态（state=2 执行成功）,&lt;br&gt;实际分配的数量（&lt;span&gt;actualNum）&lt;/span&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
          <mxGeometry x="613" y="1740" width="200" height="80" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
